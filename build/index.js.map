{"mappings":"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","sources":["src/index.ts"],"sourcesContent":["// Part 1, parse <tw-storydata> node\n// Part 2, use that data to display stuff in the #passage node\n// Part 3, other fun stuff!\n\nconst buildStoryData = (): StoryData => {\n\t// Get Story data from root node\n\tconst rootStoryDataNode = document.querySelector(\"tw-storydata\");\n\n\tif (!rootStoryDataNode) {\n\t\tthrow new Error(\"Story Data is missing! Oops!\");\n\t}\n\n\tconst name = rootStoryDataNode.getAttribute(\"name\");\n\tconst ifid = rootStoryDataNode.getAttribute(\"ifid\");\n\tconst startnode = rootStoryDataNode.getAttribute(\"startnode\");\n\n\tif (!name) {\n\t\tthrow new Error(\"Story is missing a name!\");\n\t}\n\n\tif (!ifid) {\n\t\tthrow new Error(`Story is missing an ifid!`);\n\t}\n\n\tif (!startnode) {\n\t\tthrow new Error(`No startnode specified!`);\n\t}\n\n\tconst format = rootStoryDataNode.getAttribute(\"format\");\n\tconst formatVersion = rootStoryDataNode.getAttribute(\"format-version\");\n\tconst zoom = rootStoryDataNode.getAttribute(\"zoom\");\n\tconst creator = rootStoryDataNode.getAttribute(\"creator\");\n\tconst creatorVersion = rootStoryDataNode.getAttribute(\"creator-version\");\n\n\t// Get Passages Data\n\tconst passages: Passage[] = [];\n\tconst passageNodes = document.querySelectorAll(\"tw-passagedata\");\n\n\tArray.from(passageNodes).forEach((node) => {\n\t\tconst pid = node.getAttribute(\"pid\");\n\t\tconst name = node.getAttribute(\"name\");\n\n\t\tif (!pid) {\n\t\t\tthrow new Error(`A passage (name: ${name}) is missing a pid!`);\n\t\t}\n\t\tif (!name) {\n\t\t\tthrow new Error(`A passage with pid ${pid} is missing a name!`);\n\t\t}\n\n\t\tconst tagsRaw = node.getAttribute(\"name\");\n\t\tconst positionRaw = node.getAttribute(\"name\");\n\t\tconst sizeRaw = node.getAttribute(\"name\");\n\t\tconst content = node.innerHTML;\n\n\t\tconst tags = tagsRaw?.split(\" \");\n\t\tconst position = { x: 0, y: 0 };\n\t\tif (positionRaw) {\n\t\t\tconst positionCoords = positionRaw\n\t\t\t\t.split(\",\")\n\t\t\t\t.map((n) => parseFloat(n));\n\t\t\tposition.x = positionCoords[0];\n\t\t\tposition.y = positionCoords[1];\n\t\t}\n\t\tconst size = { width: 100, height: 100 };\n\t\tif (sizeRaw) {\n\t\t\tconst dims = sizeRaw.split(\",\").map((n) => parseFloat(n));\n\t\t\tsize.width = dims[0];\n\t\t\tsize.height = dims[1];\n\t\t}\n\n\t\tpassages.push({\n\t\t\tpid,\n\t\t\tname,\n\t\t\ttags,\n\t\t\tposition,\n\t\t\tsize,\n\t\t\tcontent,\n\t\t});\n\t});\n\n\treturn {\n\t\tname,\n\t\tifid,\n\t\tformat,\n\t\tformatVersion,\n\t\tstartnode,\n\t\tzoom,\n\t\tcreator,\n\t\tcreatorVersion,\n\t\tpassages,\n\t\tcurrentPassagePid: startnode,\n\t};\n};\n\nconst getPassageByPid = (\n\tpid: Pid,\n\tpassages: Passage[]\n): Passage | undefined => {\n\treturn passages.find((passage) => {\n\t\treturn passage.pid === pid;\n\t});\n};\n\nconst displayPassage = (pid: Pid, passages: Passage[], node: Element) => {\n\tif (!pid) {\n\t\tthrow new Error(`Tried to display a passage without supplying a pid!`);\n\t}\n\tconst passage = getPassageByPid(pid, passages);\n\tif (!passage) {\n\t\tthrow new Error(\n\t\t\t`Tried to display passage with pid: ${pid}, but it doesn't exist!`\n\t\t);\n\t}\n\tnode.innerHTML = passage.content;\n};\n\n(() => {\n\tconst storyData = buildStoryData();\n\tconst storyContainer = document.querySelector(\"#tw-story\");\n\tif (!storyContainer) {\n\t\tthrow new Error(`Missing story container #tw-story!`);\n\t}\n\n\tconst passageContainer = storyContainer.querySelector(\n\t\t\"#tw-story #tw-passage\"\n\t);\n\tif (!passageContainer) {\n\t\tthrow new Error(`Missing passage container #tw-passage`);\n\t}\n\n\tdisplayPassage(\n\t\tstoryData.currentPassagePid,\n\t\tstoryData.passages,\n\t\tpassageContainer\n\t);\n})();\n"],"names":[],"version":3,"file":"index.js.map"}